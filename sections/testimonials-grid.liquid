<style>
  .testimonials {
    display: flex;
    flex-direction: column;
    gap: 40px;
  }

  .testimonials__heading {
    margin: 0;
    font-size: clamp(32px, 5vw, 42px);
    font-weight: 500;
    color: #000;
    letter-spacing: -0.02em;
  }

  .testimonials__container {
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
    overflow: hidden;
    position: relative;
  }

  /* Desktop Grid */
  @media screen and (min-width: 750px) {
    .testimonials__grid {
      display: grid !important;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      width: 100%;
    }
  }

  /* Mobile Slider */
  @media screen and (max-width: 749px) {
    .testimonials__container.swiper {
      padding: 0;
      min-width: 0;
    }

    .testimonials__grid.swiper-wrapper {
      display: flex !important;
      flex-direction: row !important;
      gap: 0 !important; /* Managed by Swiper spaceBetween */
    }

    .testimonial-card.swiper-slide {
      height: auto;
      width: 85% !important;
      flex-shrink: 0;
    }
  }

  .testimonial-card {
    background-color: #f6f5f3; /* Light beige/gray from image */
    padding: 32px;
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    height: 100%;
    min-width: 0;
    overflow-wrap: break-word;
    word-break: break-word;
  }

  .testimonial-card__stars {
    display: flex;
    gap: 2px;
  }

  .testimonial-card__stars svg path {
    fill: {{ section.settings.star_color | default: '#46de46' }};
  }

  .testimonial-card__title {
    margin: 0;
    font-size: 18px;
  }

  .testimonial-card__text {
    margin: 0;
    font-size: 14px;
    line-height: 1.6;
    font-style: italic;
    color: #333;
    flex-grow: 1;
  }

  .testimonial-card__footer {
    margin-top: 24px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 11px;
    color: #707170;
    text-transform: uppercase;
  }

  .testimonial-card__info {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }

  /* Spacing utility from theme */
  .spacing-style {
    padding-top: var(--padding-block-start, 0);
    padding-bottom: var(--padding-block-end, 0);
  }

  .testimonial-card__stars .star-component {
    display: flex;
  }
</style>

<section
  class="section section--{{ section.settings.section_width }} color-{{ section.settings.color_scheme }} spacing-style"
  style="{% render 'spacing-style', settings: section.settings %}"
>
  <div class="testimonials">
    {% if section.settings.heading != blank %}
      <h2 class="testimonials__heading">{{ section.settings.heading }}</h2>
    {% endif %}

    <div class="swiper testimonials__container" id="testimonials-{{ section.id }}">
      <div class="swiper-wrapper testimonials__grid">
        {% for block in section.blocks %}
          {% if block.type == 'testimonial' %}
            <div class="swiper-slide testimonial-card" {{ block.shopify_attributes }}>
              <div class="testimonial-card__stars">
                {% render 'star-svg',
                  width: section.settings.star_width,
                  star_count: block.settings.star_count,
                  block: block
                %}
              </div>

              {% if block.settings.title != blank %}
                <h3 class="testimonial-card__title">{{ block.settings.title }}</h3>
              {% endif %}

              {% if block.settings.text != blank %}
                <div class="testimonial-card__text">&ldquo;{{ block.settings.text | strip_html }}&rdquo;</div>
              {% endif %}

              <div class="testimonial-card__footer">
                <div class="testimonial-card__info">
                  {%- if block.settings.author != blank -%}
                    <span>{{ block.settings.author }}</span>
                  {%- endif -%}
                  {%- if block.settings.date != blank -%}
                    {%- if block.settings.author != blank -%}, {% endif -%}
                    <span>{{ block.settings.date }}</span>
                  {%- endif -%}
                  {%- if block.settings.source != blank -%}
                    {%- if block.settings.author != blank or block.settings.date != blank %} - {% endif -%}
                    <span>{{ block.settings.source }}</span>
                  {%- endif -%}
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const initSlider = () => {
      const sliderElement = document.getElementById('testimonials-{{ section.id }}');
      if (!sliderElement) return;

      const isMobile = window.innerWidth < 750;

      if (isMobile) {
        if (!sliderElement.swiper) {
          new Swiper(sliderElement, {
            slidesPerView: 'auto',
            spaceBetween: 16,
            grabCursor: true,
            watchOverflow: true,
            centeredSlides: false,
          });
        }
      } else {
        if (sliderElement.swiper) {
          sliderElement.swiper.destroy(true, true);
        }
      }
    };

    initSlider();
    window.addEventListener('resize', initSlider);
  });
</script>

{% schema %}
{
  "name": "Testimonials Grid",
  "tag": "section",
  "class": "section-wrapper",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "What People Are Saying"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "options": [
        {
          "value": "page-width",
          "label": "Page Width"
        },
        {
          "value": "full-width",
          "label": "Full Width"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Star Settings"
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star Color",
      "default": "#46de46"
    },
    {
      "type": "range",
      "id": "star_width",
      "label": "Star Width",
      "min": 10,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Section Spacing"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Padding Top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 64
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Padding Bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 64
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "range",
          "id": "star_count",
          "label": "Star Count",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "text",
          "id": "title",
          "label": "Review Title",
          "default": "The new formula is really great"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Testimonial Text",
          "default": "The new formula with advanced pre-and probiotics has really hit the bull's-eye for me. It has been a big difference in my digestion, and I am very happy with the product. I highly recommend it."
        },
        {
          "type": "text",
          "id": "author",
          "label": "Author Name",
          "default": "LOUIS C."
        },
        {
          "type": "text",
          "id": "date",
          "label": "Date",
          "default": "7/22/25"
        },
        {
          "type": "text",
          "id": "source",
          "label": "Review Source",
          "default": "AG1 REVIEW"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials Grid",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "title": "The new formula is really great",
            "text": "The new formula with advanced pre-and probiotics has really hit the bull's-eye for me. It has been a big difference in my digestion, and I am very happy with the product. I highly recommend it.",
            "author": "LOUIS C.",
            "date": "7/22/25",
            "source": "AG1 REVIEW"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "title": "A nice sweet experience",
            "text": "I have to say I have tried a lot of different types of greens and this is the best brand. I was excited to try the new flavor and it did not disappoint! I look forward to my greens daily and enjoy them!",
            "author": "ASHLEY C.",
            "date": "7/16/2025",
            "source": "AG1 REVIEW"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "title": "I Love My AG1",
            "text": "I continue to love the taste and feel good while drinking AG1 daily. The customer service is outstanding and the company rewards loyal customers with occasional perks. That makes me feel good too!",
            "author": "WENDY O.",
            "date": "3/17/25",
            "source": "AG1 REVIEW"
          }
        }
      ]
    }
  ]
}
{% endschema %}
