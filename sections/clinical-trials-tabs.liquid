{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .clinical-trials {
    overflow: hidden;
    position: relative;
    font-family: var(--font-body--family);
  }

  .clinical-trials__container {
    max-width: var(--page-width, 1400px);
    margin: 0 auto;
  }

  .clinical-trials__grid {
    display: grid;
    grid-template-columns: 1fr 0.8fr 1fr;
    gap: 60px;
    align-items: center;
    position: relative;
  }

  @media screen and (max-width: 1200px) {
    .clinical-trials__container {
        padding: 80px 0px;
    }
    .clinical-trials__grid {
      grid-template-columns: 1fr 1fr;
    }
    .clinical-trials__image-wrapper {
        display: none;
    }
  }

  @media screen and (max-width: 750px) {
    .clinical-trials__grid {
      grid-template-columns: 1fr;
      text-align: left;
      gap: 40px;
    }
    .clinical-trials__container {
        padding: 60px 0px;
    }
  }

  .clinical-trials__content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    animation: fadeInLeft 1s ease both;
  }

  @keyframes fadeInLeft {
    from { opacity: 0; transform: translateX(-30px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .clinical-trials__heading {
    line-height: 1;
    margin: 0 0 32px 0;
    font-weight: 500;
    color: rgb(var(--color-foreground));
    letter-spacing: -0.03em;
    font-family: var(--font-heading--family);
  }

  .clinical-trials__description {
    font-size: 16px;
    line-height: 1.5;
    color: rgb(var(--color-foreground));
    max-width: 440px;
  }

  .clinical-trials__image-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    animation: fadeIn 1.2s ease both;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .clinical-trials__image-wrapper img {
    max-width: 100%;
    height: auto;
    max-height: 600px;
    object-fit: contain;
    transition: transform 0.5s ease;
  }

  .clinical-trials__image-wrapper:hover img {
    transform: scale(1.02);
  }

  .clinical-trials__tabs {
    display: flex;
    flex-direction: column;
    gap: 16px;
    animation: fadeInRight 1s ease both;
  }

  @keyframes fadeInRight {
    from { opacity: 0; transform: translateX(30px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .clinical-trial-tab {
    background-color: {{ section.settings.tab_bg_color | default: 'rgb(var(--color-foreground))' }};
    color: {{ section.settings.tab_text_color | default: 'rgb(var(--color-background))' }};
    padding: 24px 32px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.1, 0, 0.1, 1);
    border: none;
    text-align: left;
    width: 100%;
  }

  .clinical-trial-tab__title {
    font-size: 26px;
    line-height: 1.1;
    font-weight: 500;
    margin: 0;
    font-family: var(--font-heading--family);
    letter-spacing: -0.01em;
  }

  .clinical-trial-tab__icon-wrapper {
    width: 48px;
    height: 48px;
    background-color: {{ section.settings.tab_accent_color | default: '#39e600' }};
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: {{ section.settings.tab_bg_color | default: 'rgb(var(--color-foreground))' }};
    flex-shrink: 0;
    transition: all 0.25s cubic-bezier(0.1, 0, 0.1, 1);
  }

  .clinical-trial-tab:hover,
  .clinical-trial-tab.is-active {
    background-color: {{ section.settings.tab_accent_color | default: '#39e600' }};
    color: {{ section.settings.tab_bg_color | default: 'rgb(var(--color-foreground))' }};
  }

  .clinical-trial-tab:hover .clinical-trial-tab__icon-wrapper,
  .clinical-trial-tab.is-active .clinical-trial-tab__icon-wrapper {
    background-color: {{ section.settings.tab_bg_color | default: 'rgb(var(--color-foreground))' }};
    color: {{ section.settings.tab_accent_color | default: '#39e600' }};
  }

  /* Side Drawer Styles */
  .clinical-drawer {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    max-width: 700px;
    height: 100%;
    background-color: #ffffff !important; /* Force solid white as fallback */
    color: rgb(var(--color-foreground));
    z-index: 2147483647 !important; /* Absolute maximum z-index */
    transform: translateX(100%);
    transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    box-shadow: -10px 0 50px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    visibility: hidden; /* Prevent flicker */
  }

  .clinical-drawer.is-open {
    transform: translateX(0);
    visibility: visible;
  }

  .clinical-drawer__overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 2147483646 !important; /* Just below the maxed-out drawer */
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .clinical-drawer__overlay.is-active {
    opacity: 1;
    visibility: visible;
  }

  .clinical-drawer__header {
    padding: 24px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
  }

  .clinical-drawer__eyebrow {
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: rgb(var(--color-foreground));
    opacity: 0.6;
    margin: 0;
    font-weight: 500;
  }

  .clinical-drawer__close {
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgb(var(--color-foreground));
    transition: opacity 0.2s ease;
  }

  .clinical-drawer__close:hover {
    opacity: 0.6;
  }

  .clinical-drawer__content {
    padding: 80px 40px;
    animation: fadeInUp 0.5s ease both;
    animation-delay: 0.2s;
  }

  @keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
  }

  .clinical-drawer__title {
    font-size: clamp(28px, 4vw, 40px);
    line-height: 1.1;
    margin: 0 0 32px 0;
    font-weight: 500;
    color: rgb(var(--color-foreground));
    letter-spacing: -0.01em;
    font-family: var(--font-heading--family);
    word-break: break-word;
  }

  .clinical-drawer__text {
    font-size: 16px;
    line-height: 1.6;
    color: rgb(var(--color-foreground));
  }

  .clinical-drawer__text p {
    margin-bottom: 20px;
  }

  @media screen and (max-width: 480px) {
    .clinical-drawer {
        max-width: 100%;
    }
  }
{%- endstyle -%}

<section
  class="clinical-trials section-{{ section.id }}-padding color-{{ section.settings.color_scheme }} gradient"
  id="clinical-trials-{{ section.id }}"
>
  <div class="clinical-trials__container">
    <div class="clinical-trials__grid">
      <div class="clinical-trials__content">
        {%- if section.settings.heading != blank -%}
          <h2 class="clinical-trials__heading">{{ section.settings.heading }}</h2>
        {%- endif -%}
        {%- if section.settings.description != blank -%}
          <div class="clinical-trials__description">
            {{ section.settings.description }}
          </div>
        {%- endif -%}
      </div>

      <div class="clinical-trials__image-wrapper">
        {%- if section.settings.product_image != blank -%}
          {{
            section.settings.product_image
            | image_url: width: 1000
            | image_tag: loading: 'lazy', sizes: '(min-width: 991px) 33vw, 80vw', widths: '300, 500, 800, 1000'
          }}
        {%- else -%}
          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
        {%- endif -%}
      </div>

      <div class="clinical-trials__tabs">
        {%- for block in section.blocks -%}
          <button
            class="clinical-trial-tab"
            type="button"
            data-index="{{ forloop.index }}"
            {{ block.shopify_attributes }}
          >
            <h3 class="clinical-trial-tab__title">{{ block.settings.tab_title }}</h3>
            <span class="clinical-trial-tab__icon-wrapper">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7 0V14M0 7H14" stroke="currentColor" stroke-width="2"/>
              </svg>
            </span>
          </button>
        {%- endfor -%}
      </div>
    </div>
  </div>

  <div class="clinical-drawer__overlay" id="clinical-overlay-{{ section.id }}"></div>

  {%- for block in section.blocks -%}
    <div
      class="clinical-drawer color-{{ section.settings.color_scheme }} gradient"
      id="clinical-drawer-{{ section.id }}-{{ forloop.index }}"
    >
      <div class="clinical-drawer__header">
        <p class="clinical-drawer__eyebrow">ADDITIONAL INFO</p>
        <button class="clinical-drawer__close" type="button" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="clinical-drawer__content">
        <h2 class="clinical-drawer__title">
          {{ forloop.index | prepend: '0' | slice: -2, 2 }} — {{ block.settings.modal_heading }}
        </h2>
        <div class="clinical-drawer__text">
          {{ block.settings.modal_content }}
        </div>
      </div>
    </div>
  {%- endfor -%}
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const sectionContainer = document.querySelector('#clinical-trials-{{ section.id }}');
    if (!sectionContainer) return;

    const tabs = sectionContainer.querySelectorAll('.clinical-trial-tab');
    const overlay = sectionContainer.querySelector('.clinical-drawer__overlay');
    const drawers = sectionContainer.querySelectorAll('.clinical-drawer');
    const closeButtons = sectionContainer.querySelectorAll('.clinical-drawer__close');

    function closeAllDrawers() {
      drawers.forEach((drawer) => drawer.classList.remove('is-open'));
      overlay.classList.remove('is-active');
      tabs.forEach((tab) => tab.classList.remove('is-active'));
      document.body.style.overflow = '';
    }

    tabs.forEach((tab) => {
      tab.addEventListener('click', function () {
        const index = this.getAttribute('data-index');
        const targetDrawer = sectionContainer.querySelector('#clinical-drawer-{{ section.id }}-' + index);

        closeAllDrawers();

        if (targetDrawer) {
          targetDrawer.classList.add('is-open');
          overlay.classList.add('is-active');
          this.classList.add('is-active');
          document.body.style.overflow = 'hidden';
        }
      });
    });

    closeButtons.forEach((btn) => {
      btn.addEventListener('click', closeAllDrawers);
    });

    overlay.addEventListener('click', closeAllDrawers);

    // Escape key to close
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') closeAllDrawers();
    });
  });
</script>

{% schema %}
{
  "name": "Clinical Trials Tabs",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "One product, four gold-standard clinical trials."
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>AG1 Next Gen has been put to the test in multiple gold-standard clinical trials, consistently showing its efficacy in closing nutrient gaps and supporting gut health across diverse populations and study designs.*¹-⁴</p>"
    },
    {
      "type": "image_picker",
      "id": "product_image",
      "label": "Product Image"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Tab Colors"
    },
    {
      "type": "color",
      "id": "tab_bg_color",
      "label": "Tab Background Color",
      "default": "#00261c"
    },
    {
      "type": "color",
      "id": "tab_text_color",
      "label": "Tab Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "tab_accent_color",
      "label": "Tab Accent Color (Hover/Active)",
      "default": "#39e600"
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 160,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 100
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 160,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 100
    }
  ],
  "blocks": [
    {
      "type": "trial",
      "name": "Trial Detail",
      "settings": [
        {
          "type": "text",
          "id": "tab_title",
          "label": "Tab Title",
          "default": "Nutrient Biomarkers"
        },
        {
          "type": "text",
          "id": "modal_heading",
          "label": "Modal Heading",
          "default": "Nutrient Biomarkers"
        },
        {
          "type": "richtext",
          "id": "modal_content",
          "label": "Modal Content",
          "default": "<p>Nutrient biomarkers are measurable substances in the body—such as levels of vitamins, minerals, or metabolites in biological tissue that indicate a person's nutritional status. AG1 Next Gen was studied in a 12-week, triple-blind, randomized, placebo-controlled clinical trial with 105 healthy adults aged 20-59, all following a Standard American Diet.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Clinical Trials Tabs",
      "blocks": [
        {
          "type": "trial",
          "settings": {
            "tab_title": "Nutrient Biomarkers",
            "modal_heading": "Nutrient Biomarkers",
            "modal_content": "<p>Nutrient biomarkers are measurable substances in the body—such as levels of vitamins, minerals, or metabolites in biological tissue that indicate a person's nutritional status. AG1 Next Gen was studied in a 12-week, triple-blind, randomized, placebo-controlled clinical trial with 105 healthy adults aged 20-59, all following a Standard American Diet. The study aimed to assess how daily intake of AG1 Next Gen influenced nutrient biomarkers, microbiome changes, and markers related to overall well-being. The study used a parallel design to compare outcomes between the AG1 Next Gen and placebo groups.</p>"
          }
        },
        {
          "type": "trial",
          "settings": {
            "tab_title": "Nutrient Gaps",
            "modal_heading": "Nutrient Gaps",
            "modal_content": "<p>Nutrient gaps refer to the difference between the amount of nutrients people consume and the amount they need for optimal health. AG1 Next Gen is designed to help close these gaps by providing a comprehensive blend of vitamins, minerals, and whole-food sourced ingredients.</p>"
          }
        },
        {
          "type": "trial",
          "settings": {
            "tab_title": "Microbiome Changes",
            "modal_heading": "Microbiome Changes",
            "modal_content": "<p>The gut microbiome is a complex ecosystem of trillions of microorganisms that play a crucial role in our health. Clinical studies on AG1 Next Gen have observed positive changes in the composition and diversity of the gut microbiome, supporting better digestive health and overall well-being.</p>"
          }
        },
        {
          "type": "trial",
          "settings": {
            "tab_title": "Nutrient Absorption & Bioavailability",
            "modal_heading": "Nutrient Absorption & Bioavailability",
            "modal_content": "<p>Bioavailability refers to the extent and rate at which the active moiety is absorbed from a pharmaceutical form and becomes available at the site of action. AG1 Next Gen uses highly bioavailable forms of nutrients to ensure your body can actually use what you're consuming.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
