{{ 'section-nutritional-science-tabs.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<div class="nutritional-tabs section-{{ section.id }}-padding color-{{ section.settings.color_scheme }} gradient">
  <div class="page-width">
    <!-- Header -->
    <div class="nutritional-tabs__header">
      {%- if section.settings.heading != blank -%}
        <h2 class="nutritional-tabs__heading {{ section.settings.heading_size }}">{{ section.settings.heading }}</h2>
      {%- endif -%}
      {%- if section.settings.subheading != blank -%}
        <div class="nutritional-tabs__subheading rte">{{ section.settings.subheading }}</div>
      {%- endif -%}
    </div>

    <!-- Tabs Navigation -->
    <div class="nutritional-tabs__nav-wrapper">
      <div class="nutritional-tabs__nav" role="tablist">
        {%- for block in section.blocks -%}
          <button
            class="nutritional-tabs__tab-btn {% if forloop.first %}is-active{% endif %}"
            type="button"
            role="tab"
            aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
            aria-controls="panel-{{ block.id }}"
            id="tab-{{ block.id }}"
            data-index="{{ forloop.index0 }}"
            {{ block.shopify_attributes }}
          >
            <span class="nutritional-tabs__tab-number">{{ block.settings.tab_number }}</span>
            <span class="nutritional-tabs__tab-title">{{ block.settings.tab_title }}</span>
          </button>
        {%- endfor -%}
      </div>
    </div>

    <!-- Tab Panels -->
    <div class="nutritional-tabs__content-wrapper">
      {%- for block in section.blocks -%}
        <div
          class="nutritional-tabs__panel {% if forloop.first %}is-active{% endif %}"
          id="panel-{{ block.id }}"
          role="tabpanel"
          aria-labelledby="tab-{{ block.id }}"
          {% unless forloop.first %}
            hidden
          {% endunless %}
        >
          <div class="nutritional-tabs__panel-grid">
            <!-- Text Content -->
            <div class="nutritional-tabs__info">
              {%- if block.settings.description != blank -%}
                <div class="nutritional-tabs__panel-desc rte">
                  {{ block.settings.description }}
                </div>
              {%- endif -%}

              <!-- Info Table -->
              <div class="nutritional-tabs__details">
                {%- if block.settings.benefits_list != blank -%}
                  <div class="nutritional-tabs__detail-row">
                    <div class="nutritional-tabs__detail-label">
                      {{ section.settings.benefits_label }}
                    </div>
                    <div class="nutritional-tabs__detail-content rte">
                      {{ block.settings.benefits_list }}
                    </div>
                  </div>
                {%- endif -%}

                {%- if block.settings.nutrients_list != blank -%}
                  <div class="nutritional-tabs__detail-row">
                    <div class="nutritional-tabs__detail-label">
                      {{ section.settings.nutrients_label }}
                    </div>
                    <div class="nutritional-tabs__detail-content rte">
                      {{ block.settings.nutrients_list }}
                    </div>
                  </div>
                {%- endif -%}
              </div>
            </div>

            <!-- Image -->
            <div class="nutritional-tabs__image-container">
              {%- if block.settings.image != blank -%}
                {{
                  block.settings.image
                  | image_url: width: 1000
                  | image_tag:
                    loading: 'eager',
                    class: 'nutritional-tabs__image',
                    sizes: '(min-width: 990px) 50vw, 100vw',
                    widths: '375, 550, 750, 1100'
                }}
              {%- else -%}
                {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
              {%- endif -%}
            </div>
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>

<script>
  function initNutritionalTabs(container) {
    const tabs = container.querySelectorAll('.nutritional-tabs__tab-btn');
    const panels = container.querySelectorAll('.nutritional-tabs__panel');

    if (tabs.length === 0) return;

    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        // Deactivate all
        tabs.forEach((t) => {
          t.classList.remove('is-active');
          t.setAttribute('aria-selected', 'false');
        });
        panels.forEach((p) => {
          p.classList.remove('is-active');
          p.setAttribute('hidden', '');
        });

        // Activate clicked
        const targetId = tab.getAttribute('aria-controls');
        const targetPanel = container.querySelector(`#${targetId}`);

        tab.classList.add('is-active');
        tab.setAttribute('aria-selected', 'true');

        if (targetPanel) {
          targetPanel.classList.add('is-active');
          targetPanel.removeAttribute('hidden');
        }
      });
    });
  }

  document.addEventListener('DOMContentLoaded', function () {
    const sections = document.querySelectorAll('.nutritional-tabs');
    sections.forEach(initNutritionalTabs);
  });

  document.addEventListener('shopify:section:load', function (event) {
    const section = event.target.querySelector('.nutritional-tabs');
    if (section) initNutritionalTabs(section);
  });
</script>

{% schema %}
{
  "name": "Nutritional Tabs",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Nutritional science for whole body health"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        { "value": "h2", "label": "Small" },
        { "value": "h1", "label": "Medium" },
        { "value": "h0", "label": "Large" }
      ],
      "default": "h1",
      "label": "Heading Size"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Foundational Nutrition supplements raise our baseline health by comprehensively nourishing the whole body, from our brain to our gut to our immune system."
    },
    {
      "type": "text",
      "id": "benefits_label",
      "label": "Benefits Label",
      "default": "Benefits supported*"
    },
    {
      "type": "text",
      "id": "nutrients_label",
      "label": "Nutrients Label",
      "default": "Nutrients"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-3"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "System Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_number",
          "label": "Tab Number",
          "default": "01."
        },
        {
          "type": "text",
          "id": "tab_title",
          "label": "Tab Title",
          "default": "Brain & nervous system"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "A nutritionally sensitive system in the body that is constantly adapting to change."
        },
        {
          "type": "richtext",
          "id": "benefits_list",
          "label": "Benefits List",
          "default": "<p>Balanced mood<br>Stress management</p>"
        },
        {
          "type": "richtext",
          "id": "nutrients_list",
          "label": "Nutrients List",
          "default": "<p>Minerals like magnesium<br>Adaptogens<br>B vitamins</p>"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "System Illustration"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Nutritional Tabs",
      "blocks": [
        {
          "type": "tab",
          "settings": {
            "tab_number": "01.",
            "tab_title": "Brain & nervous system"
          }
        },
        {
          "type": "tab",
          "settings": {
            "tab_number": "02.",
            "tab_title": "Digestive system"
          }
        },
        {
          "type": "tab",
          "settings": {
            "tab_number": "03.",
            "tab_title": "Hormone & stress system"
          }
        },
        {
          "type": "tab",
          "settings": {
            "tab_number": "04.",
            "tab_title": "Immune system"
          }
        },
        {
          "type": "tab",
          "settings": {
            "tab_number": "05.",
            "tab_title": "Metabolic system"
          }
        }
      ]
    }
  ]
}
{% endschema %}
